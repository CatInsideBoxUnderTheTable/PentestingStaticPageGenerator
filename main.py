from logging import debug
from flask import Flask
from datetime import datetime
import random
import base64


app = Flask(__name__)

def getEncodedDate() -> str:
    startup_time = datetime.today().strftime('%Y-%m-%d %H:%M:%S')
    encoded= base64.b64encode(bytes(startup_time, 'utf-8'))
    print(f'startup:{startup_time} ==ENCODED==> {str(encoded)}')

    return encoded.decode('utf-8')

def chooseAddresses(popular_web_pages: list[str] ) -> list[str]:
    addr = [] 
    for _ in range(3): 
        choosen = random.randint(0, len(popular_web_pages) -1)
        addr.append(popular_web_pages.pop(choosen))
    return addr

def setup_routes():

    well_known_addresses = ['/admin', '/login', '/api', '/downloads', '/index.html', '/']
    addresesToUse = chooseAddresses(well_known_addresses)

    encoded_date = getEncodedDate()

    def hit(): return f'{encoded_date} </br></br> HIT: !{random.randint(1000000000,9999999999)}'
    def miss():return f'{encoded_date} </br></br> MISS'

    hit_addr = addresesToUse.pop()
    print(f'hit - {hit_addr}')  
    app.add_url_rule(hit_addr, view_func=hit)

    for miss_addr in addresesToUse:
        print(f'miss - {miss_addr}')  
        app.add_url_rule(miss_addr, view_func=miss)

if __name__ == '__main__':
    random.seed(None)
    setup_routes()

    port = random.randint(5000, 12000)

    app.run(debug=True, port= port)






